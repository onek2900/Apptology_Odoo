<?xml version="1.0" encoding="utf-8"?>
<templates>

  <!-- Reusable Order Card component -->
  <t t-name="KitchenOrderCard">
    <!-- expects: order, status ('inprogress'|'completed'), showActions (boolean) -->
    <article class="order-card"
             t-att-class="{
               'order-card--inprogress': status === 'inprogress',
               'order-card--completed': status === 'completed',
               'is-online': order.is_online_order,
               'is-pickup': order.order_type == '1',
               'is-delivery': order.order_type == '2'
             }"
             t-att-data-order-id="order.id"
             t-att-data-order-type="order.order_type"
             t-att-data-online="order.is_online_order">

      <!-- Header -->
      <header class="order-card__header"
              t-attf-class="order-card__header #{order.is_online_order ? 'bg-secondary-online' : 'bg-secondary'} text-white">

        <!-- tiny badge with icon (P/D/In-store) -->
        <span class="order-card__type-badge"
              t-att-title="order.order_type == '1' ? 'Pick Up' : (order.order_type == '2' ? 'Delivery' : 'In Store')"
              t-att-aria-label="order.order_type == '1' ? 'Pick Up' : (order.order_type == '2' ? 'Delivery' : 'In Store')">
          <t t-if="order.order_type == '1'">
            <i class="fa fa-shopping-basket" aria-hidden="true"></i>
          </t>
          <t t-elif="order.order_type == '2'">
            <i class="fa fa-truck" aria-hidden="true"></i>
          </t>
          <t t-else="">
            <i class="fa fa-cutlery" aria-hidden="true"></i>
          </t>
        </span>

        <!-- Meta -->
        <div class="order-card__meta">
          <h4 class="order-card__code">
            <t t-if="order.is_online_order">
              <t t-esc="order.channel_order_reference"/>
            </t>
            <t t-else="">
              <t t-esc="order.tracking_number"/>
            </t>
          </h4>

          <div class="order-card__partner" t-esc="order.partner_id[1]"></div>
          <div class="order-card__posref" t-if="status === 'inprogress'" t-esc="order.pos_reference"></div>

          <!-- Floor: only when present and not the literal 'false'
               NOTE: escape ampersands in XML attributes -->
          <div t-if="order.floor &amp;&amp; order.floor !== 'false'" class="order-card__floor">
            <i class="fa fa-building" aria-hidden="true"></i>
            <span>Floor <t t-esc="order.floor"/></span>
          </div>
        </div>
      </header>

        <!-- Lines -->
                                        <ul class="list-group list-group-flush">
                                            <t t-foreach="order.lines" t-as="lineId" t-key="lineId">
                                                <t t-set="line" t-value="state.lines.find(l => l.id === lineId)"/>
                                                <li t-if="line" class="list-group-item">
                                                    <div class="qty">
                                                        <t t-if="!line.is_modifier">

                                                            <t t-esc="line.qty"/>×
                                                        </t>
                                                    </div>
                                                    <div class="product-info">
                                                        <div class="product-name">
                                                            <t t-if="!line.is_modifier">
                                                                <t t-esc="line.full_product_name"/>
                                                            </t>
                                                            <t t-else="">
                                                                <span class="modifier-info"
                                                                     style="padding-left:20px; font-size:0.9em; color:#bbb;">
                                                                    →
                                                                    <t t-esc="line.full_product_name"/>
                                                                </span>
                                                            </t>

                                                        </div>
                                                        <small t-if="line.note" class="note">
                                                            <i class="fa fa-tag"/>
                                                            <t t-esc="line.note"/>
                                                        </small>
                                                    </div>
                                                </li>
                                            </t>
                                        </ul>


      <!-- Clover-style: no footer actions; tap header to complete, tap items to toggle -->
    </article>
  </t>

  <!-- Page -->
  <t t-name="KitchenCustomDashBoard">

    <!-- Cancel confirmation removed (Clover-style UX) -->

    <div class="kitchen-dashboard">
      <div class="row g-4">

        <!-- In Progress -->
        <section class="col-12 col-lg-6 section section--inprogress">
          <div class="text-center section-header section-inprogress">
            <h3 class="section-title">
              In Progress
              <span class="order-count"><t t-esc="orderInProgress.length"/></span>
            </h3>
          </div>

          <div class="dashboard-section">
            <div t-if="orderInProgress.length" class="row g-4">
              <t t-foreach="orderInProgress" t-as="order" t-key="order.id">
                <div class="col-12 col-md-4 fade-in">
                  <!-- Order Card with interactive header and items -->
                  <article class="order-card order-card--inprogress"
                           t-att-class="{'is-online': order.is_online_order, 'is-pickup': order.order_type == '1', 'is-delivery': order.order_type == '2'}"
                           t-att-data-order-id="order.id">
                    <!-- Header (tap to mark whole order complete) -->
                    <header class="order-card__header"
                            t-attf-class="order-card__header #{order.is_online_order ? 'bg-secondary-online' : 'bg-secondary'} text-white"
                            t-on-click="() => this.done_order(order.id)">
                      <span class="order-card__type-badge"
                            t-att-title="order.order_type == '1' ? 'Pick Up' : (order.order_type == '2' ? 'Delivery' : 'In Store')"
                            t-att-aria-label="order.order_type == '1' ? 'Pick Up' : 'Delivery'">
                        <t t-if="order.order_type == '1'"><i class="fa fa-shopping-basket" aria-hidden="true"></i></t>
                        <t t-elif="order.order_type == '2'"><i class="fa fa-truck" aria-hidden="true"></i></t>
                        <t t-else=""><i class="fa fa-cutlery" aria-hidden="true"></i></t>
                      </span>
                      <div class="order-card__meta">
                        <h4 class="order-card__code">
                          <t t-if="order.is_online_order"><t t-esc="order.channel_order_reference"/></t>
                          <t t-else=""><t t-esc="order.tracking_number"/></t>
                        </h4>
                        <div class="order-card__partner" t-esc="order.partner_id[1]"></div>
                        <div class="order-card__posref" t-esc="order.pos_reference"></div>
                        <div t-if="order.floor &amp;&amp; order.floor !== 'false'" class="order-card__floor">
                          <i class="fa fa-building" aria-hidden="true"></i>
                          <span>Floor <t t-esc="order.floor"/></span>
                        </div>
                      </div>
                    </header>

                    <!-- Lines (tap any item to toggle ready) -->
                    <ul class="list-group list-group-flush order-card__items">
                      <t t-foreach="order.lines" t-as="lineId" t-key="'line-' + lineId">
                        <t t-set="line" t-value="state.lines.find(l => l.id === lineId)"/>
                        <li t-if="line" class="list-group-item order-card__item"
                            t-att-class="{'completed': line.order_status === 'ready'}"
                            t-on-click="() => this.accept_order_line(line.id)">
                          <div class="order-card__qty">
                            <t t-if="!line.is_modifier"><t t-esc="line.qty"/>x</t>
                          </div>
                          <div class="order-card__product">
                            <t t-if="!line.is_modifier"><t t-esc="line.full_product_name"/></t>
                            <t t-else=""><span class="modifier-info" style="padding-left:20px; font-size:0.9em; color:#bbb;"><t t-esc="line.full_product_name"/></span></t>
                          </div>
                          <div class="order-card__note" t-if="line.note"><i class="fa fa-tag"/><t t-esc="line.note"/></div>
                          <i class="fa" t-att-class="line.order_status === 'ready' ? 'fa-check-circle text-success' : 'fa-circle-thin text-muted'" aria-hidden="true"></i>
                        </li>
                      </t>
                    </ul>
                  </article>
                </div>
              </t>
            </div>
            <div t-else="" class="no-data d-flex align-items-center justify-content-center h-100">
              <h1 t-esc="noOrders"/>
            </div>
          </div>
        </section>

        <!-- Completed -->
        <section class="col-12 col-lg-6 section section--completed">
          <div class="text-center section-header">
            <h3 class="section-title">
              Completed
              <span class="order-count"><t t-esc="orderCompleted.length"/></span>
            </h3>
          </div>

          <div class="dashboard-section">
            <div t-if="orderCompleted.length" class="row g-4">
              <t t-foreach="orderCompleted" t-as="order" t-key="order.id">
                <div class="col-12 col-md-4 fade-in">
                  <t t-call="KitchenOrderCard">
                    <t t-set="order" t-value="order"/>
                    <t t-set="status" t-value="'completed'"/>
                    <t t-set="showActions" t-value="false"/>
                  </t>
                </div>
              </t>
            </div>
            <div t-else="" class="no-data d-flex align-items-center justify-content-center h-100">
              <h1 t-esc="noOrders"/>
            </div>
          </div>
        </section>

      </div>
    </div>
  </t>
</templates>

      
