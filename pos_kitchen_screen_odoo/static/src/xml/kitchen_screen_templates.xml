<?xml version="1.0" encoding="utf-8"?>
<templates>

  <t t-name="KitchenOrderCard">
    <article class="order-card"
             t-att-class="{'order-card--inprogress': status === 'inprogress', 'order-card--completed': status === 'completed', 'is-online': order.is_online_order, 'is-pickup': order.order_type == '1', 'is-delivery': order.order_type == '2'}"
             t-att-data-order-id="order.id">
      <header class="order-card__header" t-attf-class="order-card__header #{order.is_online_order ? 'bg-secondary-online' : 'bg-secondary'} text-white">
        <t t-if="status === 'inprogress'">
          <button type="button"
                  class="btn btn-success order-card__complete-all"
                  title="Mark all ready"
                  aria-label="Mark all ready"
                  t-on-click="() => this.mark_all_ready(order.id, order.lines)">
            <i class="fa fa-check"/>
          </button>
        </t>
        <span class="order-card__type-badge">
          <t t-if="order.order_type == '1'"><i class="fa fa-shopping-basket"/></t>
          <t t-elif="order.order_type == '2'"><i class="fa fa-truck"/></t>
          <t t-else=""><i class="fa fa-cutlery"/></t>
        </span>
        <div class="order-card__meta">
          <div class="order-card__code-row">
            <h4 class="order-card__code">
              <t t-if="order.is_online_order"><t t-esc="order.channel_order_reference"/></t>
              <t t-else=""><t t-esc="order.tracking_number"/></t>
            </h4>
            <t t-if="typeof order.kitchen_press_index === 'number'">
              <span class="order-card__pressbadge">Send <t t-esc="order.kitchen_press_index"/></span>
            </t>
          </div>
          <div class="order-card__partner" t-if="order.partner_id" t-esc="order.partner_id[1]"/>
          <div class="order-card__posref" t-if="status === 'inprogress'" t-esc="order.pos_reference"/>
          <div t-if="order.floor and order.floor != 'false'" class="order-card__floor"><i class="fa fa-building"/><span>Floor <t t-esc="order.floor"/></span></div>
          <div t-if="order.table_id" class="order-card__table"><i class="fa fa-table"/><span>Table <t t-esc="order.table_id[1]"/></span></div>
        </div>
      </header>
      <ul class="list-group list-group-flush order-card__items">
        <t t-foreach="this.sortedLineIds(order)" t-as="lineId" t-key="'c-line-' + (order.ticket_uid or order.id) + '-' + lineId">
          <t t-set="line" t-value="state.lines.find(l => l.id === lineId)"/>
          <t t-if="line">
            <t t-set="isModifier" t-value="this.isModifierLine(line)"/>
            <t t-if="!isModifier">
              <li class="list-group-item order-card__item" t-att-class="{'completed': line.order_status === 'ready'}">
                <div class="order-card__qty"><t t-esc="line.qty"/>x</div>
                <div class="order-card__product"><t t-esc="line.full_product_name"/></div>
                <div class="order-card__note" t-if="line.note"><i class="fa fa-tag"/><t t-esc="line.note"/></div>
                <i class="fa" t-att-class="line.order_status === 'ready' ? 'fa-check-circle text-success' : 'fa-circle-thin text-muted'"/>
              </li>
            </t>
            <t t-else="">
              <li class="list-group-item order-card__item modifier">
                <div class="order-card__qty"></div>
                <div class="order-card__product"><span class="modifier-info"><t t-esc="line.full_product_name"/></span></div>
                <div class="order-card__note" t-if="line.note"><i class="fa fa-tag"/><t t-esc="line.note"/></div>
              </li>
            </t>
          </t>
        </t>
      </ul>
    </article>
  </t>

  <t t-name="KitchenCustomDashBoard">
    <div class="kitchen-dashboard" t-att-style="'--k-card-w: ' + state.card_w + 'px; --k-card-h: ' + state.card_h + 'px; --k-content-scale: ' + state.content_scale">
      <div class="row g-4">
        <section class="col-12 section section--inprogress">
          <div class="text-center section-header section-inprogress">
            <h3 class="section-title">In Progress <span class="order-count"><t t-esc="orderInProgress.length"/></span></h3>
          </div>
          <div class="dashboard-section">
            <div t-if="orderInProgress.length" class="row g-4">
              <t t-foreach="orderInProgress" t-as="order" t-key="order.ticket_uid or order.id">
                <div class="col-12 col-md-4 fade-in">
                  <t t-call="KitchenOrderCard"><t t-set="order" t-value="order"/><t t-set="status" t-value="'inprogress'"/></t>
                </div>
              </t>
            </div>
            <div t-else="" class="no-data d-flex align-items-center justify-content-center h-100"><h1 t-esc="noOrders"/></div>
          </div>
        </section>

        <section class="col-12 section section--completed">
          <div class="text-center section-header"><h3 class="section-title">Completed <span class="order-count"><t t-esc="orderCompleted.length"/></span></h3></div>
          <div class="dashboard-section">
            <div t-if="orderCompleted.length" class="row g-4">
              <t t-foreach="orderCompleted" t-as="order" t-key="order.ticket_uid or order.id">
                <div class="col-12 col-md-4 fade-in">
                  <t t-call="KitchenOrderCard"><t t-set="order" t-value="order"/><t t-set="status" t-value="'completed'"/></t>
                </div>
              </t>
            </div>
            <div t-else="" class="no-data d-flex align-items-center justify-content-center h-100"><h1 t-esc="noOrders"/></div>
          </div>
        </section>
      </div>
    </div>
  </t>

</templates>
