/* =========================================
   0) Theme tokens (CSS variables)
   ========================================= */
:root {
  --color-primary: #4a90e2;
  --color-primary-hover: #3b78bf;
  --color-success: #2ecc71;
  --color-danger: #e74c3c;
  --color-secondary: #34495e;
  --color-secondary-online: #5b80a4;

  --bg: #f5f7fa;
  --surface: #ffffff;
  --text: #2c3e50;
  --text-muted: #6b7280;
  --border: rgba(0,0,0,0.1);
  --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

/* Dark theme */
:root[data-theme="dark"] {
  --color-primary: #8ab4f8;
  --color-primary-hover: #6a9be8;
  --color-success: #34d399;
  --color-danger: #f87171;
  --color-secondary: #93a1b6;
  --color-secondary-online: #89a6c4;

  --bg: #0b1220;
  --surface: #0f172a;
  --text: #e5e7eb;
  --text-muted: #9ca3af;
  --border: rgba(255,255,255,0.12);
  --shadow: 0 6px 12px rgba(0,0,0,0.45);
}

/* Respect OS theme if no explicit data-theme is set */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme]) {
    --color-primary: #8ab4f8;
    --color-primary-hover: #6a9be8;
    --color-success: #34d399;
    --color-danger: #f87171;
    --color-secondary: #93a1b6;
    --color-secondary-online: #89a6c4;

    --bg: #0b1220;
    --surface: #0f172a;
    --text: #e5e7eb;
    --text-muted: #9ca3af;
    --border: rgba(255,255,255,0.12);
    --shadow: 0 6px 12px rgba(0,0,0,0.45);
  }
}

/* =========================================
   1) SCSS variables (bridge to CSS vars)
   ========================================= */
$primary-color: var(--color-primary);
$primary-color-hover: var(--color-primary-hover);
$success-color: var(--color-success);
$danger-color: var(--color-danger);
$secondary-color: var(--color-secondary);
$secondary-color-online: var(--color-secondary-online);

$text-light: #ffffff;
$text-color: var(--text);
$text-muted: var(--text-muted);

$bg-color: var(--bg);
$surface-color: var(--surface);
$border-color: var(--border);
$card-shadow: var(--shadow);
$transition-speed: 0.3s;

/* =========================================
   2) Mixins & breakpoints
   ========================================= */
$bp-xs: 360px;
$bp-sm: 576px;
$bp-md: 768px;
$bp-lg: 992px;
$bp-xl: 1200px;

@mixin respond-to($max) {
  @media (max-width: $max) { @content; }
}

@mixin flex-center {
  display: flex;
  align-items: center;
}

@mixin card-hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
}

@mixin fluid-size($min, $vw, $max) {
  font-size: clamp($min, $vw, $max);
}

@mixin safe-areas {
  padding-top: max(20px, env(safe-area-inset-top));
  padding-bottom: max(16px, env(safe-area-inset-bottom));
}

/* =========================================
   3) Main Dashboard Styles
   ========================================= */
.kitchen-dashboard {
  padding: 20px;
  background-color: $bg-color;
  min-height: 100dvh;            // mobile-safe viewport height
  @include fluid-size(14px, 1.8vw, 16px);
  @include safe-areas;

  .section-header {
    position: relative;
    margin-bottom: 2rem;

    h3 {
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0;
      color: $text-color;
      @include fluid-size(18px, 2.2vw, 28px);

      .order-count {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: $primary-color;
        color: $text-light;
        border-radius: 20px;
        padding: 0.2rem 0.8rem;
        @include fluid-size(12px, 1.6vw, 16px);
        font-weight: 500;
        min-width: 35px;
        height: 28px;
        animation: pulseCount 0.3s ease-out;

        @keyframes pulseCount {
          0%   { transform: scale(1); }
          50%  { transform: scale(1.2); }
          100% { transform: scale(1); }
        }
      }
    }

    // Different color for completed section count
    .completed-section & {
      .order-count { background: $success-color; }
    }
  }

  @include respond-to($bp-md) {
    .section-header h3 .order-count {
      padding: 0.15rem 0.6rem;
    }
  }

  .dashboard-section {
    padding: 15px;

    &::-webkit-scrollbar { width: 8px; }
    &::-webkit-scrollbar-track { background: #f1f1f1; }
    &::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }

    /* Responsive card row (grid-like, no Bootstrap dependency) */
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin: 0;
    }

    /* Make any child act like a responsive column */
    .row > * {
      display: flex;
      flex: 1 1 320px;      // min card width before wrapping
      max-width: 100%;
    }

    @include respond-to($bp-lg) { .row > * { flex-basis: 300px; } }
    @include respond-to($bp-md) { .row > * { flex-basis: 260px; } }
    @include respond-to($bp-sm) { .row > * { flex-basis: 100%; } }
  }

  h3 {
    @include fluid-size(18px, 2.2vw, 28px);
    font-weight: 600;
    color: $text-color;
    margin-bottom: 1.5rem;
    border-bottom: 3px solid $primary-color;
    padding-bottom: 0.5rem;
    display: inline-block;
  }
}

/* =========================================
   4) Card Styles
   ========================================= */
.order-card {
  display: flex;
  flex-direction: column;
  width: 100%;
  border-radius: 12px;
  overflow: hidden;
  transition: transform $transition-speed ease, box-shadow $transition-speed ease;
  border: none;
  box-shadow: $card-shadow;
  background: $surface-color;

  &:hover { @include card-hover; }

  .card-header {
    padding: clamp(0.75rem, 1.2vw, 1rem);
    border: none;
    flex-shrink: 0;

    &.bg-secondary         { background: $secondary-color !important; color: $text-light; }
    &.bg-secondary-online  { background: $secondary-color-online !important; color: $text-light; }
    &.bg-success           { background: $success-color !important; color: $text-light; }
  }

  .order-info {
    ul {
      li {
        margin-bottom: 0.5rem;
        @include flex-center;
        gap: 0.5rem;

        &:last-child { margin-bottom: 0; }

        i { font-size: 1rem; width: 20px; }

        &.fw-bold {
          @include fluid-size(16px, 1.8vw, 17.6px);
          margin-bottom: 0.75rem;
        }
      }
    }
  }

  .list-group {
    flex: 1 1 auto;
    overflow-y: auto;
    max-height: 50vh;

    @include respond-to($bp-md) { max-height: 45vh; }

    &::-webkit-scrollbar { width: 4px; }
    &::-webkit-scrollbar-track { background: #f1f1f1; }
    &::-webkit-scrollbar-thumb { background: #ddd; border-radius: 2px; }
  }
}

/* =========================================
   5) Order Items List
   ========================================= */
.list-group {
  .list-group-item {
    padding: clamp(0.6rem, 1.2vw, 0.75rem) clamp(0.75rem, 2vw, 1rem);
    border-left: none;
    border-right: none;
    @include flex-center;
    gap: 1rem;

    .qty {
      font-weight: 600;
      color: $primary-color;
      @include fluid-size(14px, 1.5vw, 17px);
      min-width: 36px;
      text-align: center;
    }

    .product-info {
      flex: 1;

      .product-name {
        font-weight: 500;
        margin-bottom: 0.25rem;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        color: $text-color;
      }

      .note {
        color: $text-muted;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;

        i {
          margin-right: 0.5rem;
          color: lighten($text-muted, 10%);
        }
      }
    }
  }
}

/* =========================================
   6) Action Buttons
   ========================================= */
.card-footer {
  background: transparent;
  padding: 1rem;
  border-top: 1px solid $border-color;
  flex-shrink: 0;

  .btn {
    padding: clamp(0.45rem, 1.2vw, 0.6rem) clamp(0.8rem, 2vw, 1rem);
    @include fluid-size(14px, 1.4vw, 16px);
    font-weight: 500;
    transition: all $transition-speed ease;
    color: $text-light;

    i { margin-right: 0.5rem; }

    &.btn-primary {
      background: $primary-color;
      border-color: $primary-color;

      &:hover {
        background: $primary-color-hover; // CSS-var hover color (no Sass darken on var)
        border-color: $primary-color-hover;
      }
    }

    &.btn-outline-danger {
      color: $danger-color;
      border-color: $danger-color;
      background: transparent;

      &:hover {
        background: $danger-color;
        color: $text-light;
      }
    }
  }
}

/* Ensure â‰¥44px touch height on phones */
@media (pointer: coarse) {
  .card-footer .btn,
  .confirmation-popup .btn { min-height: 44px; }
}

/* =========================================
   7) Animations
   ========================================= */
.fade-in {
  animation: fadeIn 0.5s ease-in;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* =========================================
   8) Responsive adjustments (legacy breakpoints)
   ========================================= */
@media (max-width: 992px) {
  .kitchen-dashboard .dashboard-section { height: auto; }
}
@media (max-width: 768px) {
  .order-card { margin-bottom: 1rem; }
  .card-footer .btn {
    padding: 0.4rem 0.8rem;
    @include fluid-size(13px, 1.3vw, 14.4px);
  }
}

/* =========================================
   9) Confirmation Popup
   ========================================= */
.confirmation-popup {
  display: none;
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,.7);
  z-index: 1040;
  justify-content: center;
  align-items: center;
  backdrop-filter: blur(3px);

  &.show {
    display: flex;
    animation: fadeInBackdrop 0.2s ease-out;
  }

  .popup-content {
    background-color: $surface-color;
    border-radius: 12px;
    padding: clamp(1.5rem, 3vw, 2.5rem);
    width: min(90vw, 400px);
    box-shadow: 0 10px 25px rgba(0,0,0,.2);
    animation: slideInPopup 0.3s ease-out;
    transform-origin: center;

    h4 {
      color: $secondary-color;
      @include fluid-size(18px, 2vw, 26px);
      font-weight: 700;
      margin-bottom: 1.5rem;
      text-align: center;
      text-transform: capitalize;
    }

    p {
      color: $text-muted;
      @include fluid-size(14px, 1.6vw, 18px);
      margin-bottom: 2.5rem;
      text-align: center;
      font-weight: 500;
      line-height: 1.5;
    }
  }

  .popup-actions {
    display: flex;
    justify-content: center;
    gap: clamp(0.75rem, 2vw, 1.25rem);

    .btn {
      border-radius: 8px;
      @include fluid-size(13px, 1.5vw, 14px);
      letter-spacing: 0.5px;
      padding: clamp(10px, 2.2vw, 12px) clamp(18px, 3vw, 25px);
      font-weight: 700;
      text-transform: uppercase;
      transition: all 0.2s ease;
      min-width: 160px;
      border-width: 2px;

      &-secondary {
        background-color: $secondary-color !important;
        border-color: $secondary-color !important;
        color: $text-light !important;

        &:hover {
          color: $secondary-color !important;
          background-color: transparent !important;
          transform: translateY(-2px);
        }
      }
      &-danger {
        background-color: $danger-color !important;
        border-color: $danger-color !important;
        color: $text-light !important;

        &:hover {
          color: $danger-color !important;
          background-color: transparent !important;
          transform: translateY(-2px);
        }
      }
    }
  }
}

@keyframes fadeInBackdrop { from { opacity: 0; } to { opacity: 1; } }
@keyframes slideInPopup {
  from { opacity: 0; transform: scale(0.9) translateY(-20px); }
  to   { opacity: 1; transform: scale(1) translateY(0); }
}

@media screen and (max-width: 768px) {
  .confirmation-popup {
    .popup-content { width: 95%; margin: 0 15px; }
    .popup-actions { flex-direction: column; gap: 1rem; }
    .popup-actions .btn { width: 100%; padding: 15px 20px; }
  }
}

/* =========================================
   10) Accessibility & perf
   ========================================= */
.kitchen-dashboard :focus-visible {
  outline: 2px solid $primary-color;
  outline-offset: 2px;
}

@media (prefers-reduced-motion: reduce) {
  * { animation: none !important; transition: none !important; }
}

@media (max-width: $bp-md) {
  .order-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 10px rgba(0,0,0,.12);
  }
}

/* =========================================
   11) RTL support
   ========================================= */
[dir="rtl"] {
  .list-group .list-group-item {
    text-align: start;
    .product-info .note i {
      margin-inline-end: .5rem;
      margin-inline-start: 0;
      margin-right: 0; // neutralize LTR margin
    }
  }
  .section-header h3 { direction: rtl; }
}
